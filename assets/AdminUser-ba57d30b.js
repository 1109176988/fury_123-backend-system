import{q as ke,az as Ve,d as ae,T as Ce,s as we,r as c,I as le,o as s,B as v,w as l,j as h,y as Y,g as i,J as Se,C as Ee,W as U,l as r,D as E,e as a,x as Te,V as $e,F as Be,a as I,aA as Fe,a1 as G,c as S,Y as R,a7 as M}from"./index-93963865.js";import{v as Pe}from"./el-loading-cb9f2d60.js";import{E as ze,a as Re,b as Ue}from"./el-table-column-c008e49f.js";import{a as he,b as xe,E as qe}from"./el-select-66131ae3.js";import{a as De,b as Ie,E as Me}from"./el-form-item-481af741.js";/* empty css               */import{a as re,b as Ne}from"./el-scrollbar-fb5f2d99.js";import"./el-tooltip-4ed993c7.js";import{l as ue,i as Ae,b as Le,a as Oe,E as te}from"./el-button-d209cb55.js";import{a as je,E as Je}from"./el-space-b6f6fd3e.js";import{a as d,r as ie,E as H}from"./index-2e8019e1.js";import{_ as We}from"./plugin-vue_export-helper-1cff8a04.js";import"./vnode-40e000bf.js";import"./typescript-2a5059be.js";import"./index-f3293e7a.js";import"./validator-43c5f4f3.js";const Ye=ke({title:String,confirmButtonText:String,cancelButtonText:String,confirmButtonType:{type:String,values:ue,default:"primary"},cancelButtonType:{type:String,values:ue,default:"text"},icon:{type:Ae,default:()=>Ve},iconColor:{type:String,default:"#f90"},hideIcon:{type:Boolean,default:!1},hideAfter:{type:Number,default:200},teleported:re.teleported,persistent:re.persistent,width:{type:[String,Number],default:150}}),Ge={confirm:B=>B instanceof MouseEvent,cancel:B=>B instanceof MouseEvent},He=ae({name:"ElPopconfirm"}),Ke=ae({...He,props:Ye,emits:Ge,setup(B,{emit:_}){const p=B,{t:T}=Ce(),y=we("popconfirm"),b=c(),x=()=>{var n,V;(V=(n=b.value)==null?void 0:n.onClose)==null||V.call(n)},F=le(()=>({width:Le(p.width)})),P=n=>{_("confirm",n),x()},N=n=>{_("cancel",n),x()},q=le(()=>p.confirmButtonText||T("el.popconfirm.confirmButtonText")),K=le(()=>p.cancelButtonText||T("el.popconfirm.cancelButtonText"));return(n,V)=>(s(),v(i(Ne),$e({ref_key:"tooltipRef",ref:b,trigger:"click",effect:"light"},n.$attrs,{"popper-class":`${i(y).namespace.value}-popover`,"popper-style":i(F),teleported:n.teleported,"fallback-placements":["bottom","top","right","left"],"hide-after":n.hideAfter,persistent:n.persistent}),{content:l(()=>[h("div",{class:Y(i(y).b())},[h("div",{class:Y(i(y).e("main"))},[!n.hideIcon&&n.icon?(s(),v(i(Oe),{key:0,class:Y(i(y).e("icon")),style:Se({color:n.iconColor})},{default:l(()=>[(s(),v(Ee(n.icon)))]),_:1},8,["class","style"])):U("v-if",!0),r(" "+E(n.title),1)],2),h("div",{class:Y(i(y).e("action"))},[a(i(te),{size:"small",type:n.cancelButtonType==="text"?"":n.cancelButtonType,text:n.cancelButtonType==="text",onClick:N},{default:l(()=>[r(E(i(K)),1)]),_:1},8,["type","text"]),a(i(te),{size:"small",type:n.confirmButtonType==="text"?"":n.confirmButtonType,text:n.confirmButtonType==="text",onClick:P},{default:l(()=>[r(E(i(q)),1)]),_:1},8,["type","text"])],2)],2)]),default:l(()=>[n.$slots.reference?Te(n.$slots,"reference",{key:0}):U("v-if",!0)]),_:3},16,["popper-class","popper-style","teleported","hide-after","persistent"]))}});var Qe=We(Ke,[["__file","/home/runner/work/element-plus/element-plus/packages/components/popconfirm/src/popconfirm.vue"]]);const Xe=Be(Qe);const Ze=h("span",null,"操作",-1),el={key:0},yl=ae({__name:"AdminUser",setup(B){const _=c(!1),p=I({username:"",role_id:0,status:0}),T=c([]),y=c();d.roleOption.do({}).then(o=>{console.log(o,"res-角色下拉框数据"),T.value=o.list,y.value=Fe(o.list),console.log(y.value,"roleOpt.value")}).catch(d.errorPage);const b=I({page:1,size:10,username:"",role_id:0,status:0}),x=c(0),F=c([]);function P(){d.adminList.do(b,_).then(o=>{console.log(o,"res-查询按钮表格数据"),x.value=o.total,F.value=o.list}).catch(d.errorPage)}P();function N(){b.role_id=p.role_id,b.status=p.status,b.username=p.username,b.page=1,P()}const q=c();function K(o,t,k){d.adminSetStatus.do({id:o,status:t},_).then(()=>{F.value[k].status=t,H.success("操作成功")}).catch(d.errorMsg)}let n=-1;const V=c(""),A=c(!1),Q=c(),$=I({id:0,role_id:0});function de(o,t){n=t,V.value=o.username,$.id=o.id,$.role_id=o.role_id,A.value=!0}function oe(){A.value=!1}function pe(){var o;(o=Q.value)==null||o.validate(t=>{if(!t)return!1;d.adminSetRole.do($,_).then(()=>{F.value[n].role_id=$.role_id,H.success("变更成功"),oe()}).catch(d.errorMsg)})}const L=c(!1);function me(o){V.value=o.username,z.id=o.id,L.value=!0}const X=c(),z=I({id:0,password:""});function fe(){var o;(o=X.value)==null||o.validate(t=>{if(!t)return!1;d.adminSetPwd.do(z,_).then(()=>{H.success("重置成功"),ne()}).catch(d.errorMsg)})}function ne(){L.value=!1}const O=c(!1),g=I({username:"",password:"",role_id:0}),Z=c();function se(){O.value=!1}function ce(){var o;(o=Z.value)==null||o.validate(t=>{if(!t)return!1;d.adminCreate.do(g,_).then(()=>{var k;H.success("创建成功"),(k=q.value)==null||k.resetFields(),N(),se()}).catch(d.errorMsg)})}return(o,t)=>{const k=De,m=Ie,C=he,j=xe,f=te,J=Me,D=ze,ve=je,_e=Je,be=Xe,ye=Re,ge=qe,ee=Ue,W=Pe;return G((s(),S("div",null,[a(J,{inline:"",model:p,ref_key:"searchFormRef",ref:q},{default:l(()=>[a(m,{label:"用户名",prop:"username"},{default:l(()=>[a(k,{placeholder:"可根据前缀模糊查询",maxlength:33,modelValue:p.username,"onUpdate:modelValue":t[0]||(t[0]=e=>p.username=e)},null,8,["modelValue"])]),_:1}),a(m,{label:"角色",prop:"role_id"},{default:l(()=>[a(j,{modelValue:p.role_id,"onUpdate:modelValue":t[1]||(t[1]=e=>p.role_id=e),filerable:""},{default:l(()=>[a(C,{label:"全部",value:0}),(s(!0),S(R,null,M(T.value,e=>(s(),v(C,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"状态",prop:"status"},{default:l(()=>[a(j,{modelValue:p.status,"onUpdate:modelValue":t[2]||(t[2]=e=>p.status=e),style:{width:"80px"}},{default:l(()=>[a(C,{label:"全部",value:0}),(s(!0),S(R,null,M(o.$table.instance.status.options(),e=>(s(),v(C,{key:e.value,label:e.text,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,null,{default:l(()=>[a(f,{type:"primary",onClick:N},{default:l(()=>[r("查询")]),_:1}),a(f,{onClick:t[3]||(t[3]=e=>{var u;return(u=q.value)==null?void 0:u.resetFields()})},{default:l(()=>[r("清空")]),_:1})]),_:1})]),_:1},8,["model"]),a(ye,{data:F.value,border:""},{default:l(()=>[a(D,{prop:"id",label:"ID",width:80}),a(D,{prop:"username",label:"用户名"}),a(D,{prop:"role_id",label:"角色"},{default:l(({row:e})=>{var u;return[r(E(e.role_id?(u=y.value)==null?void 0:u.render(e.role_id):"超级管理员"),1)]}),_:1}),a(D,{prop:"status",label:"状态",width:80},{default:l(({row:e})=>[a(ve,{type:o.$table.map.status[e.status]},{default:l(()=>[r(E(o.$table.instance.status.render(e.status)),1)]),_:2},1032,["type"])]),_:1}),a(D,{width:244,label:"操作"},{header:l(()=>[a(_e,{class:"justify"},{default:l(()=>[Ze,a(f,{link:"",type:"primary",size:"small",onClick:t[4]||(t[4]=e=>O.value=!0)},{default:l(()=>[r("+ 新增")]),_:1})]),_:1})]),default:l(({row:e,$index:u})=>[e.role_id?(s(),S("span",el,[(s(!0),S(R,null,M(o.$table.instance.status.options(),w=>(s(),S(R,{key:w.value},[e.status!==w.value&&i(d).adminSetStatus.permit()?(s(),v(be,{key:0,title:`确定要${o.$table.instance.status.render(w.value)}账号 「 ${e.username} 」吗? `,"cancel-button-type":"default",width:"auto",onConfirm:ll=>K(e.id,w.value,u)},{reference:l(()=>[a(f,{type:o.$table.map.status[w.value],size:"small"},{default:l(()=>[r(E(o.$table.instance.status.render(w.value)),1)]),_:2},1032,["type"])]),_:2},1032,["title","onConfirm"])):U("",!0)],64))),128)),i(d).adminSetRole.permit()?(s(),v(f,{key:0,type:"primary",size:"small",onClick:w=>de(e,u)},{default:l(()=>[r("变更角色")]),_:2},1032,["onClick"])):U("",!0),i(d).adminSetPwd.permit()?(s(),v(f,{key:1,type:"warning",size:"small",onClick:w=>me(e)},{default:l(()=>[r("重置密码")]),_:2},1032,["onClick"])):U("",!0)])):U("",!0)]),_:1})]),_:1},8,["data"]),a(ge,{small:"","current-page":b.page,"onUpdate:currentPage":t[5]||(t[5]=e=>b.page=e),"page-size":b.size,"onUpdate:pageSize":t[6]||(t[6]=e=>b.size=e),"page-sizes":[10,20,50,100],layout:"total,prev,pager,next,sizes,jumper",total:x.value,onCurrentChange:P,onSizeChange:P},null,8,["current-page","page-size","total"]),a(ee,{modelValue:A.value,"onUpdate:modelValue":t[9]||(t[9]=e=>A.value=e),onClose:t[10]||(t[10]=e=>{var u;return(u=Q.value)==null?void 0:u.resetFields()}),title:"变更角色"},{default:l(()=>[G((s(),v(J,{ref_key:"roleFormRef",ref:Q,"label-width":"80px",model:$},{default:l(()=>[a(m,{label:"用户名"},{default:l(()=>[h("span",null,E(V.value),1)]),_:1}),a(m,{label:"角色",prop:"role_id",rules:[{required:!0,type:"number",min:1,message:"请选择角色!"}]},{default:l(()=>[a(j,{modelValue:$.role_id,"onUpdate:modelValue":t[7]||(t[7]=e=>$.role_id=e),filterable:"",style:{width:"100%"}},{default:l(()=>[a(C,{value:0,label:"请选择",disabled:""}),(s(!0),S(R,null,M(T.value,e=>(s(),v(C,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,null,{default:l(()=>[a(f,{type:"primary",onClick:pe},{default:l(()=>[r("确定")]),_:1}),a(f,{onClick:t[8]||(t[8]=e=>oe())},{default:l(()=>[r("取消")]),_:1})]),_:1})]),_:1},8,["model"])),[[W,_.value]])]),_:1},8,["modelValue"]),a(ee,{modelValue:L.value,"onUpdate:modelValue":t[13]||(t[13]=e=>L.value=e),onClose:t[14]||(t[14]=e=>{var u;return(u=X.value)==null?void 0:u.resetFields()}),title:"重置密码"},{default:l(()=>[G((s(),v(J,{ref_key:"pwdFormRef",ref:X,model:z,"label-width":"80px"},{default:l(()=>[a(m,{label:"用户名"},{default:l(()=>[h("span",null,E(V.value),1)]),_:1}),a(m,{label:"新密码",prop:"password",rules:[{require:!0,min:8,message:"请输入至少8字符的新密码"}]},{default:l(()=>[a(k,{modelValue:z.password,"onUpdate:modelValue":t[12]||(t[12]=e=>z.password=e),maxlength:33},{append:l(()=>[a(f,{onClick:t[11]||(t[11]=e=>z.password=i(ie).strings())},{default:l(()=>[r("生成")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(m,null,{default:l(()=>[a(f,{type:"primary",onClick:fe},{default:l(()=>[r("确定")]),_:1}),a(f,{onClick:ne},{default:l(()=>[r("取消")]),_:1})]),_:1})]),_:1},8,["model"])),[[W,_.value]])]),_:1},8,["modelValue"]),a(ee,{modelValue:O.value,"onUpdate:modelValue":t[19]||(t[19]=e=>O.value=e),title:"新增用户",size:"500",onClose:t[20]||(t[20]=e=>{var u;return(u=Z.value)==null?void 0:u.resetFields()})},{default:l(()=>[G((s(),v(J,{ref_key:"addFormRef",ref:Z,model:g,"label-width":"80px"},{default:l(()=>[a(m,{label:"用户名",prop:"username",rules:[{required:!0,min:8,message:"请输入至少把字符的新密8字符的用户名"}]},{default:l(()=>[a(k,{modelValue:g.username,"onUpdate:modelValue":t[15]||(t[15]=e=>g.username=e),malength:33},null,8,["modelValue"])]),_:1}),a(m,{label:"密码",prop:"password",rules:[{required:!0,min:8,message:"请输入至少把字符的新密8字符的密码"}]},{default:l(()=>[a(k,{modelValue:g.password,"onUpdate:modelValue":t[17]||(t[17]=e=>g.password=e),maxlength:33},{append:l(()=>[a(f,{onClick:t[16]||(t[16]=e=>g.password=i(ie).strings())},{default:l(()=>[r("生成")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"角色",prop:"role_id",rules:[{required:!0,type:"number",min:1,message:"请选择角色"}]},{default:l(()=>[a(j,{modelValue:g.role_id,"onUpdate:modelValue":t[18]||(t[18]=e=>g.role_id=e),filterable:"",style:{width:"100%"}},{default:l(()=>[a(C,{value:0,label:"请选择",disabled:""}),(s(!0),S(R,null,M(T.value,e=>(s(),v(C,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,null,{default:l(()=>[a(f,{onClick:ce,type:"primary"},{default:l(()=>[r("确定")]),_:1}),a(f,{onClick:se},{default:l(()=>[r("取消")]),_:1})]),_:1})]),_:1},8,["model"])),[[W,_.value]])]),_:1},8,["modelValue"])])),[[W,_.value]])}}});export{yl as default};
